<!DOCTYPE html>
<html>
<head>
    <title>Отладка путей</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Отладка путей файлов</h1>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5>Информация о путях</h5>
            </div>
            <div class="card-body">
                <div id="pathInfo"></div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5>Доступные отчеты</h5>
            </div>
            <div class="card-body">
                <div id="reportsList"></div>
            </div>
        </div>
        
        <button class="btn btn-primary mt-3" onclick="loadPathInfo()">Обновить информацию</button>
    </div>

    <script>
        async function loadPathInfo() {
            try {
                // Загружаем информацию о путях
                const response = await fetch('/list-reports');
                const data = await response.json();
                
                document.getElementById('pathInfo').innerHTML = `
                    <p><strong>Текущая директория:</strong> ${data.current_directory}</p>
                    <p><strong>Абсолютный путь:</strong> ${data.absolute_current}</p>
                `;
                
                if (data.reports && data.reports.length > 0) {
                    let html = '<table class="table"><thead><tr><th>Файл</th><th>Размер</th><th>Изменен</th><th>Путь</th><th>Действие</th></tr></thead><tbody>';
                    data.reports.forEach(report => {
                        html += `
                            <tr>
                                <td>${report.filename}</td>
                                <td>${(report.size / 1024).toFixed(1)} KB</td>
                                <td>${report.modified}</td>
                                <td><small>${report.path}</small></td>
                                <td><a href="/download-report/${report.filename}" class="btn btn-sm btn-success">Скачать</a></td>
                            </tr>
                        `;
                    });
                    html += '</tbody></table>';
                    document.getElementById('reportsList').innerHTML = html;
                } else {
                    document.getElementById('reportsList').innerHTML = '<p>Отчеты не найдены</p>';
                }
            } catch (error) {
                document.getElementById('pathInfo').innerHTML = `<div class="alert alert-danger">Ошибка: ${error.message}</div>`;
            }
        }
        
        // Загружаем информацию при открытии страницы
        loadPathInfo();
    </script>
</body>
</html>
